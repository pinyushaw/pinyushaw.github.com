---
layout: post
title: "Git 入门"
date: 2017-08-20 21:36:41
---

---

Git 是 **时光机**。你在任何时候按下"快门"，它会为你当前的工作目录建立"快照"并保存下来。你可以在任何时候回到过去，将工作目录恢复成任一"快照"的样子。

### 创建 Git 仓库

为一个目录建立时光机：

```shell
# 进入工作目录
cd ~/my-workspace 
# 创建 Git 仓库
git init
```

`git init` 命令会创建一个 Git 仓库，用于保存和管理所有的快照。所谓 Git 仓库，其实就是一个名叫 `.git` 的文件夹（隐藏文件夹）。你把这个仓库拷到其他任何一个目录下，都可以用 git 相关命令进行时光穿梭，将该目录还原成仓库里任意一个快照的样子。

### 建立快照

建立快照，实质上是把当前目录（及其文件）拷贝备份，存到 Git 仓库里。

但 Git 并不是直接拷贝了事，因为如果每次建立快照都把当前目录拷贝一份，会对磁盘资源造成极大的占用。

怎么办呢？

### Git 仓库内容

- 文件 (File)
  - 当一个文件 (File) 存到 Git 仓库时，会变成一个 __Blob__ 对象。
  - __Blob__ 对象的内容就是其对应文件 (File) 的内容 。


- 目录 (Directory)

  - 当一个目录存到 Git 仓库时，会变成一个 __Tree__ 对象。

  - __Tree__ 对象的内容是对其他 __Tree__ 对象或 __Blob__ 对象的引用 (Directory 的内容是对其他 Directory 或 File 的引用)

    ```
    100644 blob a906cb2a4a904a152e80877d4088654daad0c859      README
    100644 blob 8f94139338f9404f26296befa88755fc2598c289      Makefile
    040000 tree 99f1a6d12cb4b6f19c8655fca46c3ecf317074e0      x.py
    ```


- 快照 (Snapshot)

  - 当一个快照存到 Git 仓库时，会生成一个 __Commit__ 对象。

  - __Commit__ 对象的内容主要是对某个 __Tree__ 对象的引用，以及一些跟快照相关的信息（比如日期，作者）。

    ```
    tree d8329fc1cc938780ffdd9f94e0d364e0ea74f579
    author xpy <x.py@outlook.com> 1243040974 -0700
    committer xpy <x.py@outlook.com> 1243040974 -0700

    first commit
    ```

所有的 Git 对象 (Commit, Tree, Blob) 均以文件的形式存放在 `.git/objects` 目录下，被一个 40 字符的 SHA-1 哈希值唯一标识。

Git 对象标识通过哈希其内容得到。也就是说，只要内容不变，哈希值不会变。这样做的好处是存放过的内容不会再存放一次。

如生成快照时，对文件内容进行哈希，若发现仓库里已经存放有该哈希值对应的 __Blob__ ，便无需再存放一次。只有文件内容发生变动，一个新的 __Blob__ 才会在仓库产生。

所以，建立工作目录快照的实质，就是将目录下所有的文件、文件夹及其对应关系，转换为相应的 Git 对象 (Blob, Tree) 存放于 Git 仓库，同时生成一个 Commit 对象，作为本次快照的实体及入口。













